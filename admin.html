<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUSE Customer Bot - Admin</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --white: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            background: var(--white);
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 32px;
            color: var(--primary);
        }

        .stat-card p {
            color: #64748b;
            font-size: 14px;
        }

        .section {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .section h2 {
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg);
            font-weight: 600;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-new { background: #dbeafe; color: #1d4ed8; }
        .badge-pending { background: #fef3c7; color: #d97706; }
        .badge-completed { background: #d1fae5; color: #059669; }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ¤– MUSE Customer Bot - ê´€ë¦¬ì</h1>
        </div>
    </header>

    <div class="container">
        <!-- í†µê³„ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="stat-orders">0</h3>
                <p>ì´ ì£¼ë¬¸</p>
            </div>
            <div class="stat-card">
                <h3 id="stat-chats">0</h3>
                <p>ì´ ëŒ€í™”</p>
            </div>
            <div class="stat-card">
                <h3 id="stat-today">0</h3>
                <p>ì˜¤ëŠ˜ ë¬¸ì˜</p>
            </div>
            <div class="stat-card">
                <h3 id="stat-revenue">0ì›</h3>
                <p>ì˜ˆìƒ ë§¤ì¶œ</p>
            </div>
        </div>

        <!-- ì£¼ë¬¸ ëª©ë¡ -->
        <div class="section">
            <h2>ğŸ“¦ ì£¼ë¬¸ ëª©ë¡</h2>
            <div id="orders-list">
                <table>
                    <thead>
                        <tr>
                            <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                            <th>ë‹´ë‹¹ì</th>
                            <th>ì—°ë½ì²˜</th>
                            <th>ê¸ˆì•¡</th>
                            <th>ìƒíƒœ</th>
                            <th>ì¼ì‹œ</th>
                            <th>ì•¡ì…˜</th>
                        </tr>
                    </thead>
                    <tbody id="orders-tbody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ëŒ€í™” ë¡œê·¸ -->
        <div class="section">
            <h2>ğŸ’¬ ìµœê·¼ ëŒ€í™”</h2>
            <div id="chat-history">
            </div>
        </div>

        <!-- ì•¡ì…˜ -->
        <div class="section">
            <h2>âš™ï¸ ê´€ë¦¬</h2>
            <button class="btn btn-primary" onclick="exportData()">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
    </div>

    <script>
        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            const orders = JSON.parse(localStorage.getItem('muse_orders') || '[]');
            const chats = JSON.parse(localStorage.getItem('muse_chat_history') || '[]');

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('stat-orders').textContent = orders.length;
            document.getElementById('stat-chats').textContent = chats.length;

            const today = new Date().toDateString();
            const todayChats = chats.filter(c =>
                new Date(c.timestamp).toDateString() === today
            ).length;
            document.getElementById('stat-today').textContent = todayChats;

            const totalRevenue = orders.reduce((sum, o) =>
                sum + (o.quote?.total || 0), 0
            );
            document.getElementById('stat-revenue').textContent =
                totalRevenue.toLocaleString() + 'ì›';

            // ì£¼ë¬¸ ëª©ë¡
            const tbody = document.getElementById('orders-tbody');
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            } else {
                tbody.innerHTML = orders.map(order => `
                    <tr>
                        <td>${order.orderNumber || '-'}</td>
                        <td>${order.name || '-'}</td>
                        <td>${order.email}<br>${order.phone}</td>
                        <td>${order.quote?.total?.toLocaleString() || '-'}ì›</td>
                        <td><span class="badge badge-new">ì‹ ê·œ</span></td>
                        <td>${new Date(order.createdAt).toLocaleString('ko-KR')}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewOrder('${order.orderNumber}')">ìƒì„¸</button>
                        </td>
                    </tr>
                `).join('');
            }

            // ëŒ€í™” ë¡œê·¸
            const chatDiv = document.getElementById('chat-history');
            if (chats.length === 0) {
                chatDiv.innerHTML = '<div class="empty">ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                chatDiv.innerHTML = chats.slice(-20).reverse().map(chat => `
                    <div style="padding: 8px; border-bottom: 1px solid var(--border);">
                        <strong>${chat.role === 'user' ? 'ğŸ‘¤ ê³ ê°' : 'ğŸ¤– ë´‡'}:</strong>
                        ${chat.text.substring(0, 100)}...
                        <br>
                        <small style="color: #94a3b8;">${new Date(chat.timestamp).toLocaleString('ko-KR')}</small>
                    </div>
                `).join('');
            }
        }

        function exportData() {
            const data = {
                orders: JSON.parse(localStorage.getItem('muse_orders') || '[]'),
                chats: JSON.parse(localStorage.getItem('muse_chat_history') || '[]'),
                exportedAt: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `muse-bot-data-${Date.now()}.json`;
            a.click();
        }

        function clearData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('muse_orders');
                localStorage.removeItem('muse_chat_history');
                loadData();
                alert('ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function viewOrder(orderNumber) {
            const orders = JSON.parse(localStorage.getItem('muse_orders') || '[]');
            const order = orders.find(o => o.orderNumber === orderNumber);
            if (order) {
                alert(JSON.stringify(order, null, 2));
            }
        }

        // í˜ì´ì§€ ë¡œë“œ
        loadData();
    </script>
</body>
</html>
